<!DOCTYPE html>
<html>
<head>
    <title>语音识别</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>语音识别</h1>
    <input type="file" id="audioFile" accept="audio/*">
    <br>
    <label for="engineType">引擎类型：</label>
    <select id="engineType">
        <option value="sms16k">普通话(16k采样率)</option>
        <option value="sms8k">普通话(8k采样率)</option>
    </select>
    <br>
    <label for="aue">音频编码：</label>
    <select id="aue">
        <option value="raw">未压缩的音频</option>
        <option value="speex-wb">speex宽带编码</option>
        <option value="speex-nb">speex窄带编码</option>
        <option value="opus">opus编码</option>
    </select>
    <br>
    <label for="resultLevel">结果级别：</label>
    <select id="resultLevel">
        <option value="plain">简单结果</option>
        <option value="complete">完整结果</option>
    </select>
    <br>
    <button onclick="transcribe()">开始识别</button>
    <br>
    <div id="result"></div>

    <script>
        function transcribe() {
            var audioFile = document.getElementById('audioFile').files[0];
            var engineType = document.getElementById('engineType').value;
            var aue = document.getElementById('aue').value;
            var resultLevel = document.getElementById('resultLevel').value;

            var formData = new FormData();
            formData.append('audio', audioFile);
            formData.append('engine_type', engineType);
            formData.append('aue', aue);
            formData.append('result_level', resultLevel);

            // 生成当前时间戳
            var curTime = Math.floor(Date.now() / 1000).toString();

            // 生成校验和
            var appId = '3585358e';
            var secretKey = 'fffb9a45d4fe3e5057ac21a64bacacc1';
            var rawChecksum = appId + curTime + secretKey;
            var checksum = md5(rawChecksum);

            $.ajax({
                url: 'http://api.xfyun.cn/v1/service/v1/iat',
                type: 'POST',
                headers: {
                    'X-Appid': appId,
                    'X-CurTime': curTime,
                    'X-Param': 'YOUR_PARAM',
                    'X-CheckSum': checksum,
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    var result = JSON.parse(response);
                    document.getElementById('result').innerText = result.data;
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        function md5(str) {
            var md5Hash = CryptoJS.MD5(str);
            return md5Hash.toString();
        }
    </script>
</body>
</html>
